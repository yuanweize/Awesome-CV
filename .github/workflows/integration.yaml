name: CI

on:
  push:
    branches:
    - main
  pull_request: {}

concurrency:
  group: ci-${{ github.ref }}
  cancel-in-progress: true

jobs:
  #-----------------------------------------------------------------------------
  # LaTeX Build - Uses template data to verify the code works
  #-----------------------------------------------------------------------------
  latex:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup for CI (use template data)
      run: |
        cp config.tex.example config.tex
        cp letter_config.tex.example letter_config.tex
        mkdir -p sections
        cp sections_template/*.tex sections/
        echo "Using template data for CI build"

    - name: Compile Resume
      uses: xu-cheng/latex-action@v3
      with:
        root_file: main.tex
        latexmk_use_lualatex: true

    - name: Compile Cover Letter
      uses: xu-cheng/latex-action@v3
      with:
        root_file: coverletter.tex
        latexmk_use_lualatex: true

    - name: Upload Resume PDF
      uses: actions/upload-artifact@v4
      with:
        name: resume-pdf
        path: main.pdf

    - name: Upload Cover Letter PDF
      uses: actions/upload-artifact@v4
      with:
        name: coverletter-pdf
        path: coverletter.pdf

  #-----------------------------------------------------------------------------
  # YAML Linting
  #-----------------------------------------------------------------------------
  yaml-lint:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Install yamllint
      run: pip install yamllint

    - name: Lint YAML files
      run: yamllint .
